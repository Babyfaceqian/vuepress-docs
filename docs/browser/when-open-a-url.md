# 一个网页打开的全过程
从用户在浏览器输入域名，到web页面加载完毕的过程。
## 页面加载
html(jsp/php/aspx) 页面加载
### 协议
http/https/ftp...
### DNS解析
即域名解析，将用户输入的域名解析为相应的ip地址，然后使用该ip地址进行通行。
1. 浏览器首先搜索浏览器自身缓存的DNS记录。(chrome://net-internals/#dns) 
   
2. 如果浏览器缓存中没有找到需要的记录或记录已经过期，则搜索hosts文件和操作系统缓存。

    在Windows操作系统中，可以通过 ipconfig /displaydns 命令查看本机当前的缓存。
    
    通过hosts文件，你可以手动指定一个域名和其对应的IP解析结果，并且该结果一旦被使用，同样会被缓存到操作系统缓存中。
    
    Windows系统的hosts文件在%systemroot%\system32\drivers\etc下，linux系统的hosts文件在/etc/hosts下。

3. 如果在hosts文件和操作系统缓存中没有找到需要的记录或记录已经过期，则向域名解析服务器发送解析请求。

    其实第一台被访问的域名解析服务器就是我们平时在设置中填写的DNS服务器一项，当操作系统缓存中也没有命中的时候，系统会向DNS服务器正式发出解析请求。这里是真正意义上开始解析一个未知的域名。
    
    一般一台域名解析服务器会被地理位置临近的大量用户使用（特别是ISP的DNS），一般常见的网站域名解析都能在这里命中。

4. 如果域名解析服务器也没有该域名的记录，则开始递归+迭代解析。

    举个例子，如果我们要解析 mail.google.com。

    首先我们的域名解析服务器会向根域服务器（全球只有13台）发出请求。显然，仅凭13台服务器不可能把全球所有IP都记录下来。所以根域服务器记录的是com域服务器的IP、cn域服务器的IP、org域服务器的IP……。如果我们要查找.com结尾的域名，那么我们可以到com域服务器去进一步解析。所以其实这部分的域名解析过程是一个树形的搜索过程。
    
    根域服务器告诉我们com域服务器的IP。
    
    接着我们的域名解析服务器会向com域服务器发出请求。根域服务器并没有mail.google.com的IP，但是却有google.com域服务器的IP。
    
    接着我们的域名解析服务器会向google.com域服务器发出请求。...如此重复，直到获得mail.google.com的IP地址。
    
    为什么是递归：问题由一开始的本机要解析 mail.google.com 变成域名解析服务器要解析 mail.google.com，这是递归。
    
    为什么是迭代：问题由向根域服务器发出请求变成向com域服务器发出请求再变成向google.com域发出请求，这是迭代。

5. 获取域名对应的IP后，一步步向上返回，直到返回给浏览器。

### 发起TCP请求
浏览器会选择一个大于1024的本机端口向目标IP地址的80端口发起TCP连接请求。经过标准的TCP握手流程，建立TCP连接。

### 发起HTTP请求
其本质是在建立起的TCP连接中，按照HTTP协议标准发送一个索要网页的请求。

### 负载均衡

### 浏览器渲染
1. 浏览器根据页面内容，生成DOM Tree。根据CSS内容，生成CSS Rule Tree(规则树)。调用JS执行引擎执行JS代码。

2. 根据DOM Tree和CSS Rule Tree生成Render Tree(呈现树)

3. 据Render Tree渲染网页

## 静态资源加载
> 什么是CDN？如果我在广州访问杭州的淘宝网，跨省的通信必然造成延迟。如果淘宝网能在广东建立一个服务器，静态资源我可以直接从就近的广东服务器获取，必然能提高整个网站的打开速度，这就是CDN。CDN叫内容分发网络，是依靠部署在各地的边缘服务器，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度。

接下来的流程就是浏览器根据url加载该url下的图片内容。本质上是浏览器重新开始第一部分的流程。区别只是负责均衡服务器后端的服务器不再是应用服务器，而是提供静态资源的服务器。



